{% extends 'base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}

<div class="welcome-banner">
    <h4 class="fw-bold mb-1">Welcome, Admin!</h4>
    <small>Manage your E-Waste system efficiently. Last login: Just Now</small>
</div>

<div class="container-fluid p-0 mb-5">
    <div class="row g-4">
        
        <div class="col-md-6 col-lg-3">
            <div class="dashboard-card bg-primary-green">
                <div>
                    <i class="fa fa-truck-moving card-icon text-primary-green"></i>
                    <p class="card-title">Pickup Requests</p>
                    <p class="main-metric">{{ pickups|length|default(0) }}</p>
                </div>
                <div class="card-footer-details">
                    <span class="trend-text text-primary-green">{{ pending_requests|default(0) }} Pending Review</span>
                    <a href="{{ url_for('admin_requests') }}" class="btn btn-sm btn-primary-accent">
                        Process {{ pending_requests|default(0) }} Requests
                    </a> 
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="dashboard-card bg-secondary-blue">
                <div>
                    <i class="fa fa-users card-icon text-secondary-blue"></i>
                    <p class="card-title">Active Employees</p>
                    <p class="main-metric">{{ employees|length|default(0) }}</p>
                </div>
                <div class="card-footer-details">
                    <span class="trend-text text-secondary-blue">{{ field_staff|default(0) }} Field Staff Active</span>
                    <a href="{{ url_for('admin_employees') }}" class="btn btn-sm btn-outline-secondary">View Details</a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="dashboard-card bg-primary-green">
                <div>
                    <i class="fa fa-industry card-icon text-primary-green"></i>
                    <p class="card-title">Recycling Centers</p>
                    <p class="main-metric">{{ centers|length|default(0) }}</p>
                    <div class="progress mt-2" style="height: 6px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="card-footer-details">
                    <span class="trend-text text-primary-green">{{ open_centers|default(0) }} Centers Operational</span>
                    <a href="{{ url_for('admin_centers') }}" class="btn btn-sm btn-outline-secondary">View Details</a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="dashboard-card bg-warning-alert">
                <div>
                    <i class="fa fa-exclamation-triangle card-icon text-warning-alert"></i>
                    <p class="card-title">System Alerts & Logs</p>
                    <p class="main-metric">{{ critical_alerts|default(0) }}</p>
                </div>
                <div class="card-footer-details">
                    <span class="trend-text text-warning-alert">Last Report: {{ last_report_time|default('Just Now') }}</span>
                    {% if critical_alerts|default(0) > 0 %}
                        <a href="{{ url_for('admin_reports') }}" class="btn btn-sm btn-danger">Acknowledge ({{ critical_alerts|default(0) }})</a>
                    {% else %}
                        <a href="{{ url_for('admin_reports') }}" class="btn btn-sm btn-outline-secondary">View Logs</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid p-0">
    <div class="row">
        <div class="col-lg-12">
            <div class="card p-4">
                <h4 class="fw-bold mb-3">Recent Pickup Activity</h4>
                <p class="text-secondary">Quick overview of the 5 most recently created or updated requests.</p>

                <table class="table table-sm table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>User Name</th>
                            <th>Item Type</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>#1005</td><td>Shyno Elsa Paul</td><td>Monitor, PC</td><td><span class="status-pending status-badge">PENDING</span></td><td>2025-11-23</td><td><a href="#" class="btn btn-sm btn-outline-primary">Process</a></td></tr>
                        <tr><td>#1004</td><td>Karthika Suresh</td><td>Server Rack</td><td><span class="status-assigned status-badge">ASSIGNED</span></td><td>2025-11-22</td><td><a href="#" class="btn btn-sm btn-outline-secondary">Track</a></td></tr>
                         <tr><td>#1003</td><td>Daniel Thomas</td><td>Laptop, Cables</td><td><span class="status-complete status-badge">COMPLETE</span></td><td>2025-11-21</td><td><a href="#" class="btn btn-sm btn-outline-success">Review</a></td></tr>
                        {% for pickup in recent_pickups|default([]) %}
                        <tr>
                            <td>#{{ pickup.id }}</td>
                            <td>{{ pickup.user_name }}</td>
                            <td>{{ pickup.item_description }}</td>
                            <td><span class="status-{{ pickup.state|lower }} status-badge">{{ pickup.state|upper }}</span></td>
                            <td>{{ pickup.date }}</td>
                            <td><a href="{{ url_for('view_pickup', id=pickup.id) }}" class="btn btn-sm btn-primary">View</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}